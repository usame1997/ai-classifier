from flask import Flask, request, jsonify
from flask_cors import CORS
import re
import os

app = Flask(__name__)
# ๐น ุฅุนุฏุงุฏ CORS ุดุงูู
CORS(app, resources={
    r"/*": {
        "origins": ["*"],  # ููุฅูุชุงุฌ ุงุณุชุจุฏู ุจุงูุฃุตูู ุงููุญุฏุฏุฉ
        "methods": ["GET", "POST", "OPTIONS"],
        "allow_headers": ["Content-Type"]
    }
})

# โ ูุงุฆูุฉ ุงููููุงุช ุงูููููุนุฉ (ูุญุฏุซุฉ)
banned_keywords = [
    # ุงููุฎุฏุฑุงุช ูุฃุณูุงุกูุง
    "ุญุดูุด", "ุนุดุจ", "ุดููุฉ", "ูุจุชุงุฌูู", "ุญุจูุจ ูุฎุฏุฑุฉ", "ุชุฑุงูุงุฏูู", "ุชุฑุงูุงุฏูู ูุฎุฏุฑ", "ููุฑููู",
    "ูููุงููู", "ุจูุฏุฑุฉ", "ุดุจู", "ุฒุทูุฉ", "ุจุงูุฌู", "ุซูุฌ", "ูุงุฑูุฌูุงูุง", "ูุฎุฏุฑุงุช", "ุญุจูุจ", 
    "ุญุจูุจ ูููุณุฉ", "ุญุจูุจ ููุดุทุฉ", "ุญุจูุจ ูุฎุฏุฑุฉ", "ูุณูู ููู", "ููุงุฏ ูุฎุฏุฑุฉ", "ููุฑููุง", "ููุซ",
    "ููุซุงูููุชุงููู", "ููุฏุงููู", "ุฌุฑุนุฉ", "ุชุนุงุทู ูุฎุฏุฑุงุช", "ุฅุฏูุงู", "ูุฎุฏุฑ",
    
    # ุงูุณูุงุญ ูุงูุนูู
    "ุณูุงุญ", "ุจูุฏููุฉ", "ุทุจูุฌุฉ", "ุฑุดุงุด", "ูุณุฏุณ", "ุฐุฎูุฑุฉ", "ููุงุดููููู", "ููุงุจู",
    "ุตูุงุฑูุฎ", "ุนุจูุฉ ูุงุณูุฉ", "ูุทูุงุฉ", "ุฎูุฌุฑ", "ููุณ", "ูุชู", "ุงุบุชูุงู", "ุชูุฌูุฑ",
    "ุชูุฑูุจ ุณูุงุญ", "ุชุฑููุน", "ุนุตุงุจุฉ", "ุงุนุชุฏุงุก", "ุฐุจุญ", "ุฌุฑููุฉ", "ูุทุน ุฑูุจุฉ", "ุชูุฏูุฏ ุจุงููุชู",

    # ุงูุชุจุบ ูุงูุฏุฎุงู
    "ุชุจุบ", "ุฏุฎุงู", "ุณุฌุงุฆุฑ", "ุดูุดุฉ", "ูุนุณู", "ููุจ", "ุจูุฏ ููููุชูู", "ูููุงุช ููุจ",
    "ููุจ ููููุน", "ุดูุดุฉ ููุฑุจุฉ", "ุฏุฎุงู ููุฑุจ",

    # ุงูุฅุจุงุญูุฉ ูุงูุดุชุงุฆู
    "ุตูุฑ ูุงุถุญุฉ", "ุตูุฑ ูุซูุฑุฉ", "ุตุฏุฑ", "ูููุฏ", "ูุคุฎุฑุฉ", "ุฅุจุงุญูุฉ", "ุฌูุณ", "ุฏุนุงุฑุฉ", "ุณูุณ", 
    "porno", "nude", "xxx", "fuck", "shit", "bastard", "asshole", "screw", "ุณูุณู", "ุชุนุฑู", 
    "ุฏุฑุฏุดุฉ ุฌูุณูุฉ", "ุดุงุช ุฌูุณู", "18+", "adult only", "onlyfans", "camgirl", "snap for nudes", 
    "sex chat", "sexy", "ุจูุงุช ูุงุฑ", "ููุฏูููุงุช +18", "ูููุน ุฅุจุงุญู", "ูุตุต ุฌูุณูุฉ", 
    "ุจูุงุช ุญููุงุช", "ุชุนุงู ุฎุงุต", "ุฏุฑุฏุดุฉ ูููุจุงุฑ",

    # ุดุชุงุฆู ุฃุฎุฑู ููููุงุช ูุณูุฆุฉ
    "ูุง ููุจ", "ูุง ุญููุงู", "ุชุจุงู ูู", "ูุนูุฉ ุงููู", "ูุง ุงุจู ุงู", "ูุฐุฑ", "ููุญุท", "ูุฐุงุจ", 
    "ุญููุฑ", "ุจูุง ุดุฑู", "ูุฐู", "ุงุฎุฑุณ", "ุงูููุน", "ุชูู ุนููู", "ุญูุงุฑ", "ูุณุฎ", "ูุณุฎุฉ", 
    "ูุชุฎูู", "ุฃุจูู", "ุฎูุฒูุฑ", "ูุง ุชุงูู",

    # ุงูุงุญุชูุงู ูุงููุตุจ
    "ุชุฒููุฑ", "ูุตุจ", "ุงุญุชูุงู", "ูููุฏ ูุฒูุฑุฉ", "ูุณุจ ุณุฑูุน", "ุงุฑุจุญ ุงูุขู", "ุฑุจุญ ูุถููู",
    "ุชุญููู ุจููู ูุดุจูู", "ุดุฑุงุก ุฃุตูุงุช", "ุงุญุชูุงู ุจููู", "ุชูุงุนุจ ูุงูู", "ูุฑุตูุฉ", "ุงุฎุชุฑุงู",
]

# ุงูุญููู ุงูุชู ูุชู ูุญุตูุง
FIELDS_TO_CHECK = [
    "title",
    "description",
    "seller_name",
    "category",
]

def clean_text(text):
    text = text.strip().lower()
    words = re.findall(r'[\u0600-\u06FF\u061B-\u061F\u0640]+', text)
    return words

@app.route('/predict', methods=['POST'])
def predict():
    try:
        data = request.get_json()
        for field in FIELDS_TO_CHECK:
            content = data.get(field, "")
            if not content.strip():
                continue
            words = clean_text(content)
            for word in words:
                if word in banned_keywords:
                    return jsonify({
                        "result": "ููููุน",
                        "reason": f"ูููุฉ ููููุนุฉ: {word}",
                        "field": field
                    })
        return jsonify({"result": "ูุณููุญ"})
    except Exception as e:
        return jsonify({
            "result": "ุฎุทุฃ",
            "error": str(e)
        }), 500

if __name__ == "__main__":
    port = int(os.environ.get("PORT", 5000))  # โ ููู ูู Render
    app.run(host="0.0.0.0", port=port)
